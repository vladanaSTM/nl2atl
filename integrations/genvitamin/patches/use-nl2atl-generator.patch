*** Begin Patch
*** Update File: genVITAMIN/api/routes/ai/generate.py
@@
-"""Formula generation endpoints."""
-
-import logging
-from typing import Optional
-
-from fastapi import APIRouter, HTTPException
-from pydantic import BaseModel
-
-from api.schemas.requests import LogicType
-from api.services import get_ai_service
+"""Formula generation endpoints."""
+
+import json
+import logging
+import re
+import urllib.error
+import urllib.request
+from typing import Optional
+
+from fastapi import APIRouter, HTTPException
+from pydantic import BaseModel
+
+from api.schemas.requests import LogicType
+from api.services import get_ai_service
+from api.core.config import settings
@@
 # Use shared AIService instance
 ai_service = get_ai_service()
+
+
+def _call_nl2atl(description: str, logic: str) -> Optional[str]:
+    """Call NL2ATL API if configured, otherwise return None."""
+    base_url = settings.NL2ATL_URL
+    if not base_url:
+        logger.info("NL2ATL_URL not set; skipping NL2ATL")
+        return None
+
+    # NL2ATL currently generates ATL only
+    if logic != "ATL":
+        logger.info(f"NL2ATL supports ATL only; got {logic}")
+        return None
+
+    payload = {
+        "description": description,
+        "model": settings.NL2ATL_MODEL,
+        "few_shot": settings.NL2ATL_FEW_SHOT,
+        "num_few_shot": settings.NL2ATL_NUM_FEW_SHOT,
+        "adapter": settings.NL2ATL_ADAPTER,
+        "max_new_tokens": settings.NL2ATL_MAX_NEW_TOKENS,
+    }
+
+    url = base_url.rstrip("/") + "/generate"
+    timeout = settings.NL2ATL_TIMEOUT
+    data = json.dumps(payload).encode("utf-8")
+
+    request = urllib.request.Request(
+        url,
+        data=data,
+        headers={"Content-Type": "application/json"},
+        method="POST",
+    )
+
+    try:
+        with urllib.request.urlopen(request, timeout=timeout) as response:
+            body = response.read().decode("utf-8")
+            parsed = json.loads(body)
+            return parsed.get("formula")
+    except (urllib.error.URLError, json.JSONDecodeError) as exc:
+        logger.warning(f"NL2ATL call failed: {exc}")
+        return None
+
+
+def _normalize_coalition_syntax(formula: str) -> str:
+    """Normalize NL2ATL coalition syntax for genVITAMIN."""
+    return re.sub(r"<<\\s*([^>]+?)\\s*>>", r"<\\1>", formula)
@@
 async def generate_formula(request: GenerateFormulaRequest):
@@
-        logger.info(
-            f"Generating {request.logic_type.value} formula using knowledge base first"
-        )
-        # Use AI service to generate the formula (which uses knowledge base internally)
-        formula = await ai_service.generate_formula(
-            description=request.description, logic=request.logic_type.value
-        )
+        # Try NL2ATL first if configured
+        formula = _call_nl2atl(request.description, request.logic_type.value)
+        if formula:
+            logger.info("Generated formula using NL2ATL")
+        else:
+            logger.info(
+                f"Generating {request.logic_type.value} formula using knowledge base first"
+            )
+            # Use AI service to generate the formula (which uses knowledge base internally)
+            formula = await ai_service.generate_formula(
+                description=request.description, logic=request.logic_type.value
+            )
@@
-        logger.info(f"Returning generated formula: {formula_part[:50]}...")
-        return GenerateFormulaResponse(
+        formula_part = _normalize_coalition_syntax(formula_part)
+
+        logger.info(f"Returning generated formula: {formula_part[:50]}...")
+        return GenerateFormulaResponse(
*** End Patch

*** Begin Patch
*** Update File: genVITAMIN/api/core/config.py
@@
	# Response Streaming Configuration
	STREAM_WORD_DELAY: float = (
	    0.05  # Delay between words in fallback streaming (seconds)
	)
	STREAM_ERROR_DELAY: float = 0.02  # Delay for error messages (seconds)

+    # NL2ATL Integration (optional)
+    NL2ATL_URL: Optional[str] = None
+    NL2ATL_MODEL: str = "qwen-3b"
+    NL2ATL_FEW_SHOT: bool = True
+    NL2ATL_NUM_FEW_SHOT: Optional[int] = None
+    NL2ATL_ADAPTER: Optional[str] = "qwen-3b_finetuned_few_shot/final"
+    NL2ATL_MAX_NEW_TOKENS: int = 128
+    NL2ATL_TIMEOUT: int = 300

	# ChromaDB Configuration
*** End Patch
